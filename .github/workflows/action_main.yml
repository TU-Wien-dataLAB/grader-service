name: Development

on:
  pull_request:
    branches:
      - main
    types:
      - closed
  push:
    branches:
      - dev
    tags:
      - "*"

jobs:
  build_grader-service:
    uses: ./.github/workflows/build_service.yml
  dockerize_grader-service:
    needs: build_grader-service
    uses: ./.github/workflows/docker_service.yml


  build_labextension:
    uses: ./.github/workflows/build_labextension.yml
  dockerize_labextension:
    needs: build_labextension
    uses: ./.github/workflows/docker_labextension.yml

  build_convert:
    uses: ./.github/workflows/build_convert.yml

#  docs:
#    runs-on: ubuntu-latest
#    steps:
#      - uses: ./.github/workflows/reusable/build_docs


  pre-release:
    runs-on: ubuntu-latest
    if: startsWith(github.ref, refs/tags/)
    steps:
      - run: echo "TODO run pre-release script on specifc tags"


  release_grader-service:
    needs: dockerize_grader-service
    if: github.event.pull_request.merged == true
    uses: ./.github/workflows/publish_service.yml

  release_labextension:
    needs: dockerize_labextension
    if: github.event.pull_request.merged == true
    uses: ./.github/workflows/publish_labextension.yml

  release_convert:
    needs: build_convert
    if: github.event.pull_request.merged == true
    uses: ./.github/workflows/publish_convert.yml